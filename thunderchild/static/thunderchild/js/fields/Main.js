define("fields/models/AppModel",["jquery","lib/backbone"],function(e){var t=Backbone.Model.extend({openCreateFieldGroupModal:function(){this.trigger("openCreateFieldGroupModal")},openEditFieldGroupModal:function(e){this.trigger("openEditFieldGroupModal",e)},openCreateFieldModal:function(e){this.trigger("openCreateFieldModal",e)},openEditFieldModal:function(e){this.trigger("openEditFieldModal",e)},openConfirmDeleteFieldGroupModal:function(e){this.trigger("openConfirmDeleteFieldGroupModal",e)},openConfirmDeleteFieldModal:function(e){this.trigger("openConfirmDeleteFieldModal",e)}});return new t}),define("fields/models/FieldModel",["jquery","lib/backbone"],function(e){var t=Backbone.Model.extend();return t}),define("fields/models/FieldCollection",["jquery","fields/models/FieldModel","lib/backbone"],function(e,t){var n=Backbone.Collection.extend({url:"/dashboard/fields/fields",model:t});return new n}),define("fields/models/FieldGroupModel",["jquery","fields/models/FieldCollection","lib/backbone"],function(e,t){var n=Backbone.Model.extend({getFields:function(){return t.where({fieldgroup:this.id})}});return n}),define("fields/models/FieldGroupCollection",["jquery","fields/models/FieldGroupModel","lib/backbone"],function(e,t){var n=Backbone.Collection.extend({url:"/dashboard/fields/fieldgroups",model:t});return new n}),define("fields/views/FieldView",["jquery","fields/models/AppModel","lib/backbone"],function(e,t){var n=Backbone.View.extend({template:_.template(e("#field-template").html()),initialize:function(){this.setElement(this.template(this.model.toJSON())),this.model.on("change",this.render,this),this.model.on("destroy",this.destroyHandler,this)},events:{"click a.field-name":"clickHandler","click a.delete-field-button":"deleteClickHandler"},clickHandler:function(e){t.openEditFieldModal(this.model),e.preventDefault()},deleteClickHandler:function(){t.openConfirmDeleteFieldModal(this.model)},render:function(){var e=this.model.toJSON();this.$("tr[data-field-id]").attr("data-field-id",e.id),this.$(".field-name").text(e.field_name),this.$(".field-short-name").text("{ "+e.field_short_name+" }"),this.$(".field-type").text(e.field_type)},destroyHandler:function(){this.$el.remove()}});return n}),define("fields/views/FieldGroupView",["jquery","fields/models/FieldCollection","fields/models/AppModel","fields/views/FieldView","lib/backbone"],function(e,t,n,r){var i=Backbone.View.extend({template:_.template(e("#fieldgroup-template").html()),className:"row-fluid accordion-group",initialize:function(){t.on("add",this.fieldAddHandler,this),t.on("reset",this.render,this),t.on("destroy",this.fieldDestroyHandler,this),this.model.on("change",this.render,this),this.model.on("destroy",this.destroyHandler,this),this.render()},events:{"click .edit-group-button":"editGroupClickHandler","click .delete-group-button":"deleteClickHandler","click .create-field-button":"createFieldClickHandler","show .group-content":"collapseShowHandler","hide .group-content":"collapseHideHandler"},render:function(){this.$el.html(this.template(this.model.toJSON())),t.forEach(_.bind(this.fieldAddHandler,this)),this.model.getFields().length==0?(this.$(".no-fields-msg").removeClass("hide"),this.$("table.table").addClass("hide")):(this.$(".no-fields-msg").addClass("hide"),this.$("table.table").removeClass("hide"))},destroyHandler:function(){this.$el.remove()},editGroupClickHandler:function(e){n.openEditFieldGroupModal(this.model),e.preventDefault(),e.stopPropagation()},deleteClickHandler:function(e){n.openConfirmDeleteFieldGroupModal(this.model),e.preventDefault(),e.stopPropagation()},createFieldClickHandler:function(e){n.openCreateFieldModal(this.model),e.preventDefault(),e.stopPropagation()},fieldAddHandler:function(e){if(e.get("fieldgroup")==this.model.id){var t=new r({model:e});this.$(".table").append(t.$el),this.$(".no-fields-msg").addClass("hide"),this.$("table.table").removeClass("hide")}},fieldDestroyHandler:function(e){this.model.getFields().length==0?(this.$(".no-fields-msg").removeClass("hide"),this.$("table.table").addClass("hide")):(this.$(".no-fields-msg").addClass("hide"),this.$("table.table").removeClass("hide"))},collapseShowHandler:function(){this.$(".controls").fadeIn()},collapseHideHandler:function(){this.$(".controls").fadeOut()}});return i}),define("fields/views/AppView",["jquery","fields/models/AppModel","fields/models/FieldGroupCollection","fields/views/FieldGroupView","lib/backbone"],function(e,t,n,r){var i=Backbone.View.extend({el:"body",initialize:function(){n.on("reset",this.fieldGroupResetHandler,this),n.on("add",this.fieldGroupAddHandler,this),n.on("remove",this.fieldGroupRemoveHandler,this),e("#create-fieldgroup-button").click(_.bind(this.createFieldGroupClickHandler,this))},createFieldGroupClickHandler:function(e){t.openCreateFieldGroupModal(),e.preventDefault()},fieldGroupResetHandler:function(){if(n.models.length==0)e("#no-groups-msg").removeClass("hide");else{var t=e("#content-container");_.each(n.models,function(e){var n=new r({model:e});t.append(n.el)})}},fieldGroupAddHandler:function(t){e("#no-groups-msg").addClass("hide"),view=new r({model:t}),e("#content-container").append(view.el)},fieldGroupRemoveHandler:function(){n.models.length===0&&e("#no-groups-msg").removeClass("hide")}});return i}),define("fields/views/FieldGroupModalView",["jquery","fields/models/AppModel","fields/models/FieldGroupCollection","lib/utilities","lib/backbone","lib/bootstrap"],function(e,t,n,r){var i=Backbone.View.extend({el:"#fieldgroup-modal",initialize:function(){this.EDIT_MODE="editMode",this.CREATE_MODE="createMode",t.on("openCreateFieldGroupModal",this.openCreateFieldGroupModal,this),t.on("openEditFieldGroupModal",this.openEditFieldGroupModal,this),r.autoAlphanumeric(e("#id_fieldgroup_name"),e("#id_fieldgroup_short_name"))},events:{"click #fieldgroup-form-modal-ok-button":"okClickHandler"},setTitle:function(e){this.$(".modal-header h3").text(e)},removeErrors:function(){this.$(".alert").remove(),this.$(".error").removeClass("error")},addErrors:function(t){var n="",r=_.template(e("#form-error-template").text());_.each(t,function(t,i){_.each(t,function(e){n+="<li>"+e+"</li>"}),e("#id_"+i).before(r({errors:n})),e("#id_"+i).parent().addClass("error"),n=""})},close:function(){this.$el.modal("hide")},open:function(){this.removeErrors(),this.$el.modal("show")},okClickHandler:function(t){if(e("#fieldgroup-form-modal-ok-button").hasClass("disabled")){t.preventDefault();return}if(this.mode==this.EDIT_MODE){var r=e("#fieldgroup-modal-form").serializeObject();this.model.save(r,{wait:!0,success:_.bind(this.close,this),error:_.bind(function(t,n){this.removeErrors(),n.status==400&&(resp=e.parseJSON(n.responseText),this.addErrors(resp.errors))},this)})}else{var r=e("#fieldgroup-modal-form").serializeObject();n.create(r,{wait:!0,success:_.bind(this.close,this),error:_.bind(function(t,n){this.removeErrors(),n.status==400&&(resp=e.parseJSON(n.responseText),this.addErrors(resp.errors))},this)})}t.preventDefault()},openCreateFieldGroupModal:function(){this.mode=this.CREATE_MODE,this.setTitle("Create field group"),e("#fieldgroup-modal-form")[0].reset(),this.open(),e("#fieldgroup-modal-form *:input[type!=hidden]:first").focus()},openEditFieldGroupModal:function(t){this.mode=this.EDIT_MODE,this.setTitle("Edit field group"),this.model=t,this.open(),e("#id_fieldgroup_name").val(this.model.get("fieldgroup_name")).focus(),e("#id_fieldgroup_short_name").val(this.model.get("fieldgroup_short_name"))}});return i}),define("fields/views/ConfirmDeleteModalView",["jquery","fields/models/AppModel","lib/backbone"],function(e,t){var n=Backbone.View.extend({el:"#confirm-delete-modal",initialize:function(){t.on("openConfirmDeleteFieldGroupModal",this.openConfirmDeleteFieldGroupModal,this),t.on("openConfirmDeleteFieldModal",this.openConfirmDeleteFieldModal,this)},events:{"click #confirm-delete-button":"confirmDeleteHandler"},confirmDeleteHandler:function(e){this.model.destroy(),this.close(),e.preventDefault()},setMessage:function(t){e("#confirm-delete-message").html(t)},openConfirmDeleteFieldGroupModal:function(e){this.model=e,this.setMessage("Are you sure you want to <b>permanently</b> delete this field group including all of it's fields?"),this.open()},openConfirmDeleteFieldModal:function(e){this.model=e,this.setMessage("Are you sure you want to <b>permanently</b> delete this field?"),this.open()},close:function(){this.$el.modal("hide")},open:function(){this.$el.modal("show")}});return n}),define("fields/views/FieldModalView",["jquery","fields/models/AppModel","fields/models/FieldCollection","lib/utilities","lib/backbone"],function(e,t,n,r){var i=Backbone.View.extend({el:"#field-modal",initialize:function(){this.EDIT_MODE="editMode",this.CREATE_MODE="createMode",this.okButton=e("#field-form-modal-ok-button"),t.on("openCreateFieldModal",this.openInCreateMode,this),t.on("openEditFieldModal",this.openInEditMode,this),r.autoAlphanumeric(e("#id_field_name"),e("#id_field_short_name")),this.resetForm()},events:{"click #field-form-modal-ok-button":"okButtonClickHandler","change #id_field_type":"fieldTypeChangeHandler"},setTitle:function(e){this.$(".modal-header h3").text(e)},open:function(){this.removeErrors(),this.okButtonDisabled(!1),this.$el.modal("show"),e("#field-form *:input[type!=hidden]:first").focus()},close:function(){this.$el.modal("hide")},okButtonDisabled:function(e){return e!==undefined&&this.okButton.toggleClass("disabled",e),this.okButton.hasClass("disabled")},removeErrors:function(){this.$(".alert").remove(),this.$(".error").removeClass("error")},addErrors:function(t){var n="",r=_.template(e("#form-error-template").text());_.each(t,function(t,i){_.each(t,function(e){n+="<li>"+e+"</li>"}),e("#id_"+i).before(r({errors:n})),e("#id_"+i).parent().addClass("error"),n=""})},fieldTypeChangeHandler:function(){var t=e("#id_field_type").val();e("#id_field_choices").parent().toggle(t=="select"||t=="checkboxes"||t=="radiobuttons"),e("#id_max_length").parent().toggle(t=="textarea"||t=="text")},okButtonClickHandler:function(t){var r=e("#field-form").serializeObject();if(this.okButtonDisabled()==1){t.preventDefault();return}this.okButtonDisabled(!0),this.mode===this.CREATE_MODE?n.create(r,{wait:!0,success:_.bind(this.close,this),error:_.bind(function(t,n){this.removeErrors(),n.status==400&&(resp=e.parseJSON(n.responseText),this.addErrors(resp.errors)),this.okButtonDisabled(!1)},this)}):this.mode===this.EDIT_MODE&&this.model.save(r,{wait:!0,success:_.bind(this.close,this),error:_.bind(function(t,n){this.removeErrors(),n.status==400&&(resp=e.parseJSON(n.responseText),this.addErrors(resp.errors)),this.okButtonDisabled(!1)},this)}),t.preventDefault()},resetForm:function(){this.$("#field-form")[0].reset(),this.$("#id_field_choices").parent().hide(),this.$("#id_max_length").parent().show()},openInCreateMode:function(e){this.mode=this.CREATE_MODE,this.resetForm(),this.setTitle("Create Field"),this.$("#id_fieldgroup").val(e.get("id")),this.open()},openInEditMode:function(t){this.model=t,this.mode=this.EDIT_MODE,this.setTitle("Edit Field"),_.each(t.toJSON(),function(t,n){var r=e("#field-form input[name="+n+"]");if(r.length>0)switch(r.attr("type")){case"text":case"hidden":r.val(t);break;case"radio":case"checkbox":t===!0?r.filter("[value='True']").prop("checked",!0):r.filter("[value='False']").prop("checked",!0)}else e("#field-form :input[name="+n+"]").val(t)}),this.fieldTypeChangeHandler(),this.open()}});return i}),requirejs(["jquery","fields/models/AppModel","fields/models/FieldCollection","fields/models/FieldGroupCollection","fields/views/AppView","fields/views/FieldGroupModalView","fields/views/ConfirmDeleteModalView","fields/views/FieldModalView","lib/log"],function(e,t,n,r,i,s,o,u){e(function(){var e=new i,t=new s,a=new o,f=new u;r.reset(fieldGroupData),n.reset(fieldData)})}),define("fields/Main",[],function(){})