(function(){var g,j,b,e,h,c,a,f,i;var d=function(k,l){return function(){return k.apply(l,arguments)}};c=Backbone.Model.extend({selected:false});b=Backbone.Collection.extend({model:c,url:assetsURL});g=Backbone.Model.extend({showUploadModal:function(){return this.trigger("showUploadModal")},showDeleteSelectedModal:function(){return this.trigger("showDeleteSelectedModal")},showPreviewModal:function(k){return this.trigger("showPreviewModal",k)}});f=Backbone.View.extend({el:"#preview_modal",initialize:function(){this.$el.modal().modal("hide");this.model.on("showPreviewModal",this.show,this);return this.imageTemplate=_.template($("#preview_modal_template").html())},show:function(k){var l;l=this.$el.find(".modal-body");l.html(this.imageTemplate(k.toJSON()));return this.$el.modal("show")}});a=Backbone.View.extend({el:"#delete_selected_modal",initialize:function(){this.$el.modal().modal("hide");return this.model.on("showDeleteSelectedModal",this.show,this)},events:{"click #modal_confirm_delete_button":"confirmDeleteButtonHandler"},confirmDeleteButtonHandler:function(q){var k,n,m,p,l,o;k=this.model.get("assetCollection");m=[];o=k.models;for(p=0,l=o.length;p<l;p++){n=o[p];if(n.get("selected")){m.push(n)}}_.each(m,function(r){return r.destroy()});this.$el.modal("hide");this.model.set("numCheckedAssets",0);return q.preventDefault()},show:function(){return this.$el.modal("show")}});i=Backbone.View.extend({el:"#upload_modal",initialize:function(){this.CHOOSE_FILE_STATE="choose_file";this.UPLOADING_STATE="uploading";this.NAME_CONFLICT_STATE="name_conflict";this.$el.modal().modal("hide");this.modalFileField=$("#modal_file_field");this.uploadButton=$("#modal_upload_button");this.progressBar=this.$el.find(".progress .bar");this.replaceAssetControlsDisabled=false;this.model.on("showUploadModal",this.show,this);this.options.uploadService.on("progress",this.uploadProgressHandler,this);this.options.uploadService.on("complete",this.uploadCompleteHandler,this);this.options.uploadService.on("nameConflict",this.uploadNameConflictHandler,this);return this.options.uploadService.on("replaceComplete",this.replaceCompleteHandler,this)},events:{"click #modal_upload_button":"uploadClickHandler","change #modal_file_field":"fileFieldChangeHandler","click #yes-replace-button":"replaceFileClickHandler","click #no-replace-button":"dontReplaceFileClickHandler"},showState:function(l){var k;k=this.$el.find("[data-state]");k.filter("[data-state='"+l+"']").show();return k.filter("[data-state!='"+l+"']").hide()},uploadClickHandler:function(m){var l,k;k=this.modalFileField[0].files;if(k.length>0){l=k[0];this.showState(this.UPLOADING_STATE);this.options.uploadService.uploadFile(l)}return m.preventDefault()},uploadProgressHandler:function(k){return this.progressBar.width(k+"%")},uploadCompleteHandler:function(){this.$el.modal("hide");return window.location.replace(window.location.href)},uploadNameConflictHandler:function(k){this.model.set("uploadResponse",k);return this.showState(this.NAME_CONFLICT_STATE)},show:function(){this.uploadButton.addClass("disabled");$("#modal_upload_form")[0].reset();this.showState(this.CHOOSE_FILE_STATE);return this.$el.modal("show")},fileFieldChangeHandler:function(){return this.uploadButton.removeClass("disabled")},replaceFileClickHandler:function(k){var l;if(!this.replaceAssetControlsDisabled){l=this.model.get("uploadResponse");this.replaceAssetControlsDisabled=true;this.options.uploadService.replaceAsset(l.name_conflict.id,l.id)}return k.preventDefault()},replaceCompleteHandler:function(){this.$el.modal("hide");return window.location.replace(window.location.href)},dontReplaceFileClickHandler:function(k){if(!this.replaceAssetControlsDisabled){this.$el.modal("hide");window.location.replace(window.location.href)}return k.preventDefault()}});e=Backbone.View.extend({initialize:function(){return this.model.on("destroy",this.destroyHandler,this)},events:{click:"clickHandler",'click .thumbnail input[type="checkbox"]':"thumbnailCheckboxClickHandler",'change .thumbnail input[type="checkbox"]':"thumbnailCheckboxChangeHandler"},clickHandler:function(k){if(this.model.get("is_image")){this.options.appModel.showPreviewModal(this.model);return k.preventDefault()}},thumbnailCheckboxClickHandler:function(k){return k.stopPropagation()},thumbnailCheckboxChangeHandler:function(k){var l;l=$(k.currentTarget).attr("data-id");if($(k.currentTarget).is(":checked")){this.model.set("selected",true);return this.trigger("selection_change",true)}else{this.model.set("selected",false);return this.trigger("selection_change",false)}},destroyHandler:function(){this.$el.remove();return this.off()}});h=Backbone.View.extend({el:"#thumbnails_list",initialize:function(){return this.$el.children().each(d(function(l,o){var n,k;o=$(o);k=new c({id:o.find(".thumbnail").attr("data-id"),is_image:o.find(".thumbnail").attr("data-is-image")==="True",filename:o.find(".thumbnail").attr("data-filename"),url:o.find(".thumbnail").attr("data-url"),size:o.find(".size").text(),width:o.find("img").attr("data-width"),height:o.find("img").attr("data-height")});n=new e({el:o,model:k,appModel:this.model});n.on("selection_change",this.assetSelectionChangeHandler,this);return this.collection.add(k)},this))},assetSelectionChangeHandler:function(l){var k;k=$(".thumbnail input[type='checkbox']:checked").length;return this.model.set("numCheckedAssets",k)}});j=Backbone.View.extend({el:window,initialize:function(){this.thumbnailsForm=$("#thumbnails_form");return this.model.on("change:numCheckedAssets",this.numCheckedAssetsChangeHandler,this)},events:{"click #upload_button":"uploadButtonClickHandler","click #deselect_button":"deselectButtonClickHandler","click #delete_button":"deleteButtonClickHandler","click #select_all_button":"selectAllButtonClickHandler"},uploadButtonClickHandler:function(k){this.model.showUploadModal();return k.preventDefault()},deselectButtonClickHandler:function(l){var k;k=$(l.currentTarget);if(!k.hasClass("disabled")){this.thumbnailsForm[0].reset();this.model.set("numCheckedAssets",0)}return l.preventDefault()},selectAllButtonClickHandler:function(m){var k,l;k=$(m.currentTarget);l=$(".thumbnail input[type='checkbox']");l.prop("checked",true);l.trigger("change");this.model.set("numCheckedAssets",l.length);return m.preventDefault()},deleteButtonClickHandler:function(l){var k;k=$(l.currentTarget);if(!k.hasClass("disabled")){this.model.showDeleteSelectedModal()}return l.preventDefault()},numCheckedAssetsChangeHandler:function(l,k){if(k>0){$("#deselect_button").removeClass("disabled");return $("#delete_button").removeClass("disabled")}else{$("#deselect_button").addClass("disabled");return $("#delete_button").addClass("disabled")}}});$(function(){var r,k,p,o,m,n,l,q;k=new b();m=new g({assetCollection:k});q=new window.MediaUploadService();l=new i({model:m,uploadService:q});o=new a({model:m});n=new f({model:m});r=new j({model:m});return p=new h({collection:k,model:m})})}).call(this);