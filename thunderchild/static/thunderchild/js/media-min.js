(function(){var f,i,b,d,g,c,a,e,h;c=Backbone.Model.extend({selected:false});b=Backbone.Collection.extend({model:c,url:"/backend/media/assets"});f=Backbone.Model.extend({showUploadModal:function(){return this.trigger("showUploadModal")},showDeleteSelectedModal:function(){return this.trigger("showDeleteSelectedModal")},showPreviewModal:function(j){return this.trigger("showPreviewModal",j)}});e=Backbone.View.extend({el:"#preview_modal",initialize:function(){this.$el.modal({backdrop:"static"}).modal("hide");this.model.on("showPreviewModal",this.show,this);return this.imageTemplate=_.template($("#preview_modal_template").html())},show:function(j){var k;k=this.$el.find(".modal-body");k.html(this.imageTemplate(j.toJSON()));return this.$el.modal("show")}});a=Backbone.View.extend({el:"#delete_selected_modal",initialize:function(){this.$el.modal({backdrop:"static"}).modal("hide");return this.model.on("showDeleteSelectedModal",this.show,this)},events:{"click #modal_confirm_delete_button":"confirmDeleteButtonHandler"},confirmDeleteButtonHandler:function(p){var j,m,l,o,k,n;j=this.model.get("assetCollection");l=[];n=j.models;for(o=0,k=n.length;o<k;o++){m=n[o];if(m.get("selected")){l.push(m)}}_.each(l,function(q){return q.destroy()});this.$el.modal("hide");this.model.set("numCheckedAssets",0);return p.preventDefault()},show:function(){return this.$el.modal("show")}});h=Backbone.View.extend({el:"#upload_modal",initialize:function(){this.CHOOSE_FILE_STATE="choose_file";this.UPLOADING_STATE="uploading";this.NAME_CONFLICT_STATE="name_conflict";this.$el.modal({backdrop:"static"}).modal("hide");this.modalFileField=$("#modal_file_field");this.uploadButton=$("#modal_upload_button");this.progressBar=this.$el.find(".progress .bar");return this.model.on("showUploadModal",this.show,this)},events:{"click #modal_upload_button":"uploadClickHandler","change #modal_file_field":"fileFieldChangeHandler"},showState:function(k){var j;j=this.$el.find("[data-state]");j.filter("[data-state='"+k+"']").show();return j.filter("[data-state!='"+k+"']").hide()},uploadClickHandler:function(l){var k,j;j=this.modalFileField[0].files;if(j.length>0){k=j[0];this.showState(this.UPLOADING_STATE);this.uploadFile(k)}return l.preventDefault()},onProgressHandler:function(k){var j;j=Math.round((k.position/k.total)*100);this.progressBar.width(j+"%");return console.log("percentage: ",j,k)},onLoadHandler:function(k){var j;if(k.currentTarget.status===200){j=$.parseJSON(k.currentTarget.response);if(j.name_conflict){return this.showState(this.NAME_CONFLICT_STATE)}else{this.$el.modal("hide");return window.location.replace(window.location.href)}}},uploadFile:function(k,l,m){var j,n;j=new FormData();j.append("file",k);n=new XMLHttpRequest();n.open("POST","/backend/media/upload",true);n.upload.onprogress=_.bind(this.onProgressHandler,this);n.onload=_.bind(this.onLoadHandler,this);n.setRequestHeader("X-CSRFToken",Utilities.getCookie("csrftoken"));return n.send(j)},show:function(){this.uploadButton.addClass("disabled");$("#modal_upload_form")[0].reset();this.showState(this.CHOOSE_FILE_STATE);return this.$el.modal("show")},fileFieldChangeHandler:function(){return this.uploadButton.removeClass("disabled")}});d=Backbone.View.extend({initialize:function(){return this.model.on("destroy",this.destroyHandler,this)},events:{click:"clickHandler",'click .thumbnail input[type="checkbox"]':"thumbnailCheckboxClickHandler",'change .thumbnail input[type="checkbox"]':"thumbnailCheckboxChangeHandler"},clickHandler:function(j){if(this.model.get("is_image")){this.options.appModel.showPreviewModal(this.model);return j.preventDefault()}},thumbnailCheckboxClickHandler:function(j){return j.stopPropagation()},thumbnailCheckboxChangeHandler:function(j){var k;k=$(j.currentTarget).attr("data-id");if($(j.currentTarget).is(":checked")){this.model.set("selected",true);return this.trigger("selection_change",true)}else{this.model.set("selected",false);return this.trigger("selection_change",false)}},destroyHandler:function(){this.$el.remove();return this.off()}});g=Backbone.View.extend({el:"#thumbnails_list",initialize:function(){this.collection.on("reset",this.collectionResetHandler,this);return this.thumbnail_template=_.template($("#thumbnail_template").html())},collectionResetHandler:function(){var m,l,p,o,k,n,j;this.$el.empty();n=this.collection.models;j=[];for(o=0,k=n.length;o<k;o++){l=n[o];p=l.toJSON();m=new d({el:this.thumbnail_template(p),model:l,appModel:this.model});m.on("selection_change",this.assetSelectionChangeHandler,this);j.push(this.$el.append(m.el))}return j},assetSelectionChangeHandler:function(k){var j;j=$(".thumbnail input[type='checkbox']:checked").length;return this.model.set("numCheckedAssets",j)}});i=Backbone.View.extend({el:window,initialize:function(){this.thumbnailsForm=$("#thumbnails_form");return this.model.on("change:numCheckedAssets",this.numCheckedAssetsChangeHandler,this)},events:{"click #upload_button":"uploadButtonClickHandler","click #deselect_button":"deselectButtonClickHandler","click #delete_button":"deleteButtonClickHandler"},uploadButtonClickHandler:function(j){this.model.showUploadModal();return j.preventDefault()},deselectButtonClickHandler:function(k){var j;j=$(k.currentTarget);if(!j.hasClass("disabled")){this.thumbnailsForm[0].reset();this.model.set("numCheckedAssets",0)}return k.preventDefault()},deleteButtonClickHandler:function(k){var j;j=$(k.currentTarget);if(!j.hasClass("disabled")){this.model.showDeleteSelectedModal()}return k.preventDefault()},numCheckedAssetsChangeHandler:function(k,j){if(j>0){$("#deselect_button").removeClass("disabled");return $("#delete_button").removeClass("disabled")}else{$("#deselect_button").addClass("disabled");return $("#delete_button").addClass("disabled")}}});$(function(){var p,j,o,n,l,m,k;j=new b();l=new f({assetCollection:j});k=new h({model:l});n=new a({model:l});m=new e({model:l});p=new i({model:l});o=new g({collection:j,model:l});return j.reset($.parseJSON(initial_data))})}).call(this);