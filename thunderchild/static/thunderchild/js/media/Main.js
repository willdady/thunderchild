define("media/models/FileUploadModel",["jquery","lib/utilities","lib/backbone"],function(e,t){var n=Backbone.Model.extend({initialize:function(e){this.file=e,this.set("name",e.name),this.xhr=new XMLHttpRequest},upload:function(){var e=new FormData;e.append("file",this.file),this.xhr.open("POST",thunderchild.uploadURL,!0),this.xhr.upload.onprogress=_.bind(function(e){var t=Math.round(e.position/e.total*100);this.trigger("progress",t)},this),this.xhr.onload=_.bind(function(e){e.currentTarget.status==200?this.trigger("complete",this):this.trigger("error",this,e)},this),this.xhr.onerror=_.bind(function(e){this.trigger("error",this,e)},this),this.xhr.setRequestHeader("X-CSRFToken",t.getCookie("csrftoken")),this.xhr.send(e)},abort:function(){this.xhr.abort()}});return n}),define("media/models/AppModel",["jquery","media/models/FileUploadModel","lib/utilities","lib/backbone"],function(e,t,n){var r=Backbone.Model.extend({showUploadModal:function(){this.trigger("showUploadModal")},showDeleteSelectedModal:function(){this.trigger("showDeleteSelectedModal")},showPreviewModal:function(e){this.trigger("showPreviewModal",e)},uploadFiles:function(e){this.uploadQueue=[],this.uploadQueueHasErrors=!1,_.each(e,function(e,n){var r=new t(e);r.on("complete",this._uploadCompleteHandler,this),r.on("error",this._uploadErrorHandler,this),this.uploadQueue.push(r),this.trigger("fileUploadQueued",r)},this),this.uploadQueue[0].upload()},_dequeueFileUploadModel:function(e){if(this.uploadQueue==undefined)return;if(this.uploadQueue.length==0)return;var t=this.uploadQueue.indexOf(e);t!==-1&&(this.uploadQueue.splice(t,1),e.off("complete",this._uploadCompleteHandler,this),e.off("error",this._uploadCompleteHandler,this))},_uploadCompleteHandler:function(e){this._dequeueFileUploadModel(e),this.uploadQueue.length>0?this.uploadQueue[0].upload():this.uploadQueueHasErrors?this.trigger("uploadsCompleteWithErrors"):this.reloadPage()},_uploadErrorHandler:function(e){this._dequeueFileUploadModel(e),this.uploadQueueHasErrors=!0,this.uploadQueue.length>0?this.uploadQueue[0].upload():this.trigger("uploadsCompleteWithErrors")},cancelAllUploads:function(){if(this.uploadQueue)for(var e=0;e<this.uploadQueue.length;e++)this.uploadQueue[e].abort();this.reloadPage()},reloadPage:function(){window.location=window.location.href.split("?")[0]},assetSelectionCallback:function(e){parent!==window&&parent.appModel.assetSelectionCallback(e)}});return new r}),define("media/views/UploadItemView",["jquery","lib/backbone"],function(e){var t=Backbone.View.extend({tagName:"li",template:_.template(e("#upload-item-template").text()),initialize:function(){this.$el.html(this.template(this.model.toJSON())),this.progressBar=this.$(".progress .bar"),this.model.on("progress",this.progressHandler,this),this.model.on("complete",this.completeHandler,this),this.model.on("error",this.errorHandler,this)},progressHandler:function(e){this.progressBar.css("width",e+"%")},completeHandler:function(){this.$el.addClass("complete")},errorHandler:function(){this.$el.addClass("error")}});return t}),define("media/views/UploadModalView",["jquery","media/models/AppModel","media/views/UploadItemView","lib/backbone"],function(e,t,n){var r=Backbone.View.extend({el:"#upload-modal",initialize:function(){this.CHOOSE_FILE_STATE="choose-file",this.UPLOADING_STATE="uploading",this.UPLOAD_ERRORS="upload-errors",this.modalFileField=e("#modal_file_field"),this.uploadButton=e("#modal_upload_button"),this.progressBar=this.$el.find(".progress .bar"),t.on("showUploadModal",this.show,this),t.on("fileUploadQueued",this.fileUploadQueued,this),t.on("uploadsCompleteWithErrors",this.uploadsCompleteWithErrors,this)},events:{"click #modal_upload_button":"uploadClickHandler","change #modal_file_field":"fileFieldChangeHandler","click #cancel-uploads-button":"cancelUploadsClickHandler","click #confirm-upload-errors-button":"confirmUploadErrorsHandler"},showState:function(e){var t=this.$el.find("[data-state]");t.filter("[data-state~='"+e+"']").show(),t.filter(":not([data-state~='"+e+"'])").hide()},uploadClickHandler:function(e){var n=this.modalFileField[0].files;n.length>0&&(this.showState(this.UPLOADING_STATE),t.uploadFiles(n)),e.preventDefault()},show:function(){this.uploadButton.addClass("disabled"),e("#modal_upload_form")[0].reset(),this.showState(this.CHOOSE_FILE_STATE),this.$el.modal("show")},fileFieldChangeHandler:function(){this.uploadButton.removeClass("disabled")},fileUploadQueued:function(e){var t=new n({model:e});this.$(".modal-body div[data-state~=uploading] ul").append(t.el)},cancelUploadsClickHandler:function(e){t.cancelAllUploads(),e.preventDefault()},uploadsCompleteWithErrors:function(){this.showState(this.UPLOAD_ERRORS)},confirmUploadErrorsHandler:function(e){t.reloadPage(),e.preventDefault()}});return r}),define("media/views/DeleteSelectedModalView",["jquery","media/models/AppModel","lib/backbone","lib/bootstrap"],function(e,t){var n=Backbone.View.extend({el:"#delete_selected_modal",initialize:function(){this.$el.modal().modal("hide"),t.on("showDeleteSelectedModal",this.show,this)},events:{"click #modal_confirm_delete_button":"confirmDeleteButtonHandler"},confirmDeleteButtonHandler:function(t){e("#thumbnails-form").submit(),t.preventDefault()},show:function(){this.$el.modal("show")}});return n}),define("media/views/PreviewModalView",["jquery","media/models/AppModel","lib/backbone","lib/bootstrap"],function(e,t){var n=Backbone.View.extend({el:"#preview-modal",initialize:function(){this.$el.modal().modal("hide"),t.on("showPreviewModal",this.show,this),this.imageTemplate=_.template(e("#preview-modal_template").html())},show:function(e){var t=this.$el.find(".modal-body");t.html(this.imageTemplate(e.toJSON())),e.get("type")==="image/png"&&t.find(".img-wrapper").addClass("transparency"),this.$el.modal("show")}});return n}),define("media/views/AppView",["jquery","media/models/AppModel","lib/backbone"],function(e,t){var n=Backbone.View.extend({el:"body",initialize:function(){this.thumbnailsForm=e("#thumbnails-form"),t.on("change:numCheckedAssets",this.numCheckedAssetsChangeHandler,this)},events:{"click #upload_button":"uploadButtonClickHandler","click #deselect_button":"deselectButtonClickHandler","click #delete_button":"deleteButtonClickHandler","click #select_all_button":"selectAllButtonClickHandler"},uploadButtonClickHandler:function(e){t.showUploadModal(),e.preventDefault()},deselectButtonClickHandler:function(n){var r=e(n.currentTarget);r.hasClass("disabled")||(this.thumbnailsForm[0].reset(),t.set("numCheckedAssets",0)),n.preventDefault()},selectAllButtonClickHandler:function(n){var r=e(n.currentTarget),i=e(".thumbnail input[type='checkbox']");i.prop("checked",!0),i.trigger("change"),t.set("numCheckedAssets",i.length),n.preventDefault()},deleteButtonClickHandler:function(n){var r=e(n.currentTarget);r.hasClass("disabled")||t.showDeleteSelectedModal(),n.preventDefault()},numCheckedAssetsChangeHandler:function(t,n){n>0?(e("#deselect_button").removeClass("disabled"),e("#delete_button").removeClass("disabled")):(e("#deselect_button").addClass("disabled"),e("#delete_button").addClass("disabled"))}});return n}),define("media/models/AssetModel",["lib/backbone"],function(){var e=Backbone.Model.extend({selected:!1});return e}),define("media/views/AssetItemView",["jquery","media/models/AppModel","lib/backbone"],function(e,t){var n=Backbone.View.extend({initialize:function(){this.model.on("destroy",this.destroyHandler,this)},events:{click:"clickHandler",'click .thumbnail input[type="checkbox"]':"thumbnailCheckboxClickHandler",'change .thumbnail input[type="checkbox"]':"thumbnailCheckboxChangeHandler"},clickHandler:function(e){this.model.get("is_image")&&(t.showPreviewModal(this.model),e.preventDefault())},thumbnailCheckboxClickHandler:function(e){e.stopPropagation()},thumbnailCheckboxChangeHandler:function(t){var n=e(t.currentTarget).attr("data-id");e(t.currentTarget).is(":checked")?(this.model.set("selected",!0),this.trigger("selection_change",!0)):(this.model.set("selected",!1),this.trigger("selection_change",!1))},destroyHandler:function(){this.$el.remove(),this.off()}});return n}),define("media/views/AssetItemsView",["jquery","media/models/AppModel","media/models/AssetModel","media/views/AssetItemView","lib/backbone"],function(e,t,n,r){var i=Backbone.View.extend({el:"#thumbnails_list",initialize:function(){this.$el.children().each(_.bind(function(t,i){i=e(i);var s=new n({id:i.find(".thumbnail").attr("data-id"),is_image:i.find(".thumbnail").attr("data-is-image")==="True",filename:i.find(".thumbnail").attr("data-filename"),url:i.find(".thumbnail").attr("data-url"),type:i.find(".thumbnail").attr("data-type"),size:i.find(".size").text(),width:i.find("img").attr("data-width"),height:i.find("img").attr("data-height")}),o=new r({el:i,model:s});o.on("selection_change",this.assetSelectionChangeHandler,this)},this))},assetSelectionChangeHandler:function(n){var r=e(".thumbnail input[type='checkbox']:checked").length;t.set("numCheckedAssets",r)}});return i}),requirejs(["jquery","media/models/AppModel","media/views/UploadModalView","media/views/DeleteSelectedModalView","media/views/PreviewModalView","media/views/AppView","media/views/AssetItemsView","lib/log"],function(e,t,n,r,i,s,o){e(function(){console.log("INIT!");var e=new n,t=new r,u=new i,a=new s,f=new o})}),define("media/Main",[],function(){})