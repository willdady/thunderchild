define("media/models/AppModel",["jquery","lib/utilities","lib/backbone"],function(e,t){var n=Backbone.Model.extend({showUploadModal:function(){this.trigger("showUploadModal")},showDeleteSelectedModal:function(){this.trigger("showDeleteSelectedModal")},showPreviewModal:function(e){this.trigger("showPreviewModal",e)},uploadFile:function(n){var r=new FormData;r.append("file",n);var i=new XMLHttpRequest;i.open("POST",uploadURL,!0),i.upload.onprogress=_.bind(function(e){var t=Math.round(e.position/e.total*100);this.trigger("progress",t)},this),i.onload=_.bind(function(t){if(t.currentTarget.status==200){var n=e.parseJSON(t.currentTarget.response);n.name_conflict?this.trigger("nameConflict",n):this.trigger("complete")}},this),i.setRequestHeader("X-CSRFToken",t.getCookie("csrftoken")),i.send(r)},replaceAsset:function(t,n){e.post(replaceURL,{existing_asset_id:t,new_asset_id:n},_.bind(function(e){e.response=="OK"?this.trigger("replaceComplete"):this.trigger("replaceError")},this))}});return new n}),define("media/views/UploadModalView",["jquery","media/models/AppModel","lib/backbone"],function(e,t){var n=Backbone.View.extend({el:"#upload-modal",initialize:function(){this.CHOOSE_FILE_STATE="choose_file",this.UPLOADING_STATE="uploading",this.NAME_CONFLICT_STATE="name_conflict",this.modalFileField=e("#modal_file_field"),this.uploadButton=e("#modal_upload_button"),this.progressBar=this.$el.find(".progress .bar"),this.replaceAssetControlsDisabled=!1,t.on("showUploadModal",this.show,this),t.on("progress",this.uploadProgressHandler,this),t.on("complete",this.uploadCompleteHandler,this),t.on("nameConflict",this.uploadNameConflictHandler,this),t.on("replaceComplete",this.replaceCompleteHandler,this)},events:{"click #modal_upload_button":"uploadClickHandler","change #modal_file_field":"fileFieldChangeHandler","click #yes-replace-button":"replaceFileClickHandler","click #no-replace-button":"dontReplaceFileClickHandler"},showState:function(e){var t=this.$el.find("[data-state]");t.filter("[data-state='"+e+"']").show(),t.filter("[data-state!='"+e+"']").hide()},uploadClickHandler:function(e){var n=this.modalFileField[0].files;n.length>0&&(file=n[0],this.showState(this.UPLOADING_STATE),t.uploadFile(file)),e.preventDefault()},uploadProgressHandler:function(e){this.progressBar.width(e+"%")},uploadCompleteHandler:function(){this.$el.modal("hide"),window.location.replace(mediaURL)},uploadNameConflictHandler:function(e){t.set("uploadResponse",e),this.showState(this.NAME_CONFLICT_STATE)},show:function(){this.uploadButton.addClass("disabled"),e("#modal_upload_form")[0].reset(),this.showState(this.CHOOSE_FILE_STATE),this.$el.modal("show")},fileFieldChangeHandler:function(){this.uploadButton.removeClass("disabled")},replaceFileClickHandler:function(e){if(!this.replaceAssetControlsDisabled){var n=t.get("uploadResponse");this.replaceAssetControlsDisabled=!0,t.replaceAsset(n.name_conflict.id,n.id)}e.preventDefault()},replaceCompleteHandler:function(){this.$el.modal("hide"),window.location.replace(window.location.href)},dontReplaceFileClickHandler:function(e){this.replaceAssetControlsDisabled||(this.$el.modal("hide"),window.location.replace(mediaURL)),e.preventDefault()}});return n}),define("media/views/DeleteSelectedModalView",["jquery","media/models/AppModel","lib/backbone","lib/bootstrap"],function(e,t){var n=Backbone.View.extend({el:"#delete_selected_modal",initialize:function(){this.$el.modal().modal("hide"),t.on("showDeleteSelectedModal",this.show,this)},events:{"click #modal_confirm_delete_button":"confirmDeleteButtonHandler"},confirmDeleteButtonHandler:function(t){e("#thumbnails-form").submit(),t.preventDefault()},show:function(){this.$el.modal("show")}});return n}),define("media/views/PreviewModalView",["jquery","media/models/AppModel","lib/backbone","lib/bootstrap"],function(e,t){var n=Backbone.View.extend({el:"#preview-modal",initialize:function(){this.$el.modal().modal("hide"),t.on("showPreviewModal",this.show,this),this.imageTemplate=_.template(e("#preview-modal_template").html())},show:function(e){var t=this.$el.find(".modal-body");t.html(this.imageTemplate(e.toJSON())),e.get("type")==="image/png"&&t.find(".img-wrapper").addClass("transparency"),this.$el.modal("show")}});return n}),define("media/views/AppView",["jquery","media/models/AppModel","lib/backbone"],function(e,t){var n=Backbone.View.extend({el:"body",initialize:function(){this.thumbnailsForm=e("#thumbnails-form"),t.on("change:numCheckedAssets",this.numCheckedAssetsChangeHandler,this)},events:{"click #upload_button":"uploadButtonClickHandler","click #deselect_button":"deselectButtonClickHandler","click #delete_button":"deleteButtonClickHandler","click #select_all_button":"selectAllButtonClickHandler"},uploadButtonClickHandler:function(e){t.showUploadModal(),e.preventDefault()},deselectButtonClickHandler:function(n){var r=e(n.currentTarget);r.hasClass("disabled")||(this.thumbnailsForm[0].reset(),t.set("numCheckedAssets",0)),n.preventDefault()},selectAllButtonClickHandler:function(n){var r=e(n.currentTarget),i=e(".thumbnail input[type='checkbox']");i.prop("checked",!0),i.trigger("change"),t.set("numCheckedAssets",i.length),n.preventDefault()},deleteButtonClickHandler:function(n){var r=e(n.currentTarget);r.hasClass("disabled")||t.showDeleteSelectedModal(),n.preventDefault()},numCheckedAssetsChangeHandler:function(t,n){n>0?(e("#deselect_button").removeClass("disabled"),e("#delete_button").removeClass("disabled")):(e("#deselect_button").addClass("disabled"),e("#delete_button").addClass("disabled"))}});return n}),define("media/models/AssetModel",["lib/backbone"],function(){var e=Backbone.Model.extend({selected:!1});return e}),define("media/views/AssetItemView",["jquery","media/models/AppModel","lib/backbone"],function(e,t){var n=Backbone.View.extend({initialize:function(){this.model.on("destroy",this.destroyHandler,this)},events:{click:"clickHandler",'click .thumbnail input[type="checkbox"]':"thumbnailCheckboxClickHandler",'change .thumbnail input[type="checkbox"]':"thumbnailCheckboxChangeHandler"},clickHandler:function(e){this.model.get("is_image")&&(t.showPreviewModal(this.model),e.preventDefault())},thumbnailCheckboxClickHandler:function(e){e.stopPropagation()},thumbnailCheckboxChangeHandler:function(t){var n=e(t.currentTarget).attr("data-id");e(t.currentTarget).is(":checked")?(this.model.set("selected",!0),this.trigger("selection_change",!0)):(this.model.set("selected",!1),this.trigger("selection_change",!1))},destroyHandler:function(){this.$el.remove(),this.off()}});return n}),define("media/views/AssetItemsView",["jquery","media/models/AppModel","media/models/AssetModel","media/views/AssetItemView","lib/backbone"],function(e,t,n,r){var i=Backbone.View.extend({el:"#thumbnails_list",initialize:function(){this.$el.children().each(_.bind(function(t,i){i=e(i);var s=new n({id:i.find(".thumbnail").attr("data-id"),is_image:i.find(".thumbnail").attr("data-is-image")==="True",filename:i.find(".thumbnail").attr("data-filename"),url:i.find(".thumbnail").attr("data-url"),type:i.find(".thumbnail").attr("data-type"),size:i.find(".size").text(),width:i.find("img").attr("data-width"),height:i.find("img").attr("data-height")}),o=new r({el:i,model:s});o.on("selection_change",this.assetSelectionChangeHandler,this)},this))},assetSelectionChangeHandler:function(n){var r=e(".thumbnail input[type='checkbox']:checked").length;t.set("numCheckedAssets",r)}});return i}),requirejs(["jquery","media/models/AppModel","media/views/UploadModalView","media/views/DeleteSelectedModalView","media/views/PreviewModalView","media/views/AppView","media/views/AssetItemsView","lib/log"],function(e,t,n,r,i,s,o){e(function(){console.log("INIT!");var e=new n,t=new r,u=new i,a=new s,f=new o})}),define("media/Main",[],function(){})