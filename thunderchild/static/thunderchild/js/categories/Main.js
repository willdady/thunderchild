define("categories/models/AppModel",["jquery","lib/backbone"],function(e){var t=Backbone.Model.extend({openCreateCategoryGroupModal:function(){this.trigger("openCreateCategoryGroupModal")},openEditCategoryGroupModal:function(e){this.trigger("openEditCategoryGroupModal",e)},openCreateCategoryModal:function(e){this.trigger("openCreateCategoryModal",e)},openEditCategoryModal:function(e){this.trigger("openEditCategoryModal",e)},openConfirmDeleteCategoryGroupModal:function(e){this.trigger("openConfirmDeleteCategoryGroupModal",e)},openConfirmDeleteCategoryModal:function(e){this.trigger("openConfirmDeleteCategoryModal",e)}});return new t}),define("categories/models/CategoryModel",["jquery","lib/backbone"],function(e){var t=Backbone.Model.extend();return t}),define("categories/models/CategoryCollection",["jquery","categories/models/CategoryModel","lib/backbone"],function(e,t){var n=Backbone.Collection.extend({url:"/dashboard/categories/categories",model:t});return new n}),define("categories/models/CategoryGroupModel",["jquery","categories/models/CategoryCollection","lib/backbone"],function(e,t){var n=Backbone.Model.extend({getCategories:function(){return t.where({categorygroup:this.id})}});return n}),define("categories/models/CategoryGroupCollection",["jquery","categories/models/CategoryGroupModel","lib/backbone"],function(e,t){var n=Backbone.Collection.extend({url:"/dashboard/categories/categorygroups",model:t});return new n}),define("categories/views/CategoryView",["jquery","categories/models/AppModel","lib/backbone"],function(e,t){var n=Backbone.View.extend({template:_.template(e("#category-template").html()),initialize:function(){this.setElement(this.template(this.model.toJSON())),this.model.on("change",this.render,this),this.model.on("destroy",this.destroyHandler,this)},events:{"click a.category-name":"clickHandler","click a.delete-category-button":"deleteClickHandler"},clickHandler:function(e){t.openEditCategoryModal(this.model),e.preventDefault()},deleteClickHandler:function(){t.openConfirmDeleteCategoryModal(this.model)},render:function(){this.$el.replaceWith(this.template(this.model.toJSON()))},destroyHandler:function(){this.$el.remove()}});return n}),define("categories/views/CategoryGroupView",["jquery","categories/models/CategoryCollection","categories/models/AppModel","categories/views/CategoryView","lib/backbone"],function(e,t,n,r){var i=Backbone.View.extend({template:_.template(e("#categorygroup-template").html()),className:"row-fluid accordion-group",initialize:function(){t.on("add",this.categoryAddHandler,this),t.on("reset",this.render,this),t.on("destroy",this.categoryDestroyHandler,this),this.model.on("change",this.render,this),this.model.on("destroy",this.destroyHandler,this),this.render()},events:{"click .edit-group-button":"editGroupClickHandler","click .delete-group-button":"deleteClickHandler","click .create-category-button":"createCategoryClickHandler","show .group-content":"collapseShowHandler","hide .group-content":"collapseHideHandler"},render:function(){this.$el.html(this.template(this.model.toJSON())),t.forEach(_.bind(this.categoryAddHandler,this)),this.model.getCategories().length==0?(this.$(".no-categories-msg").removeClass("hide"),this.$("table.table").addClass("hide")):(this.$(".no-categories-msg").addClass("hide"),this.$("table.table").removeClass("hide"))},destroyHandler:function(){this.$el.remove()},editGroupClickHandler:function(e){n.openEditCategoryGroupModal(this.model),e.preventDefault(),e.stopPropagation()},deleteClickHandler:function(e){n.openConfirmDeleteCategoryGroupModal(this.model),e.preventDefault(),e.stopPropagation()},createCategoryClickHandler:function(e){n.openCreateCategoryModal(this.model),e.preventDefault(),e.stopPropagation()},categoryAddHandler:function(e){if(e.get("categorygroup")==this.model.id){var t=new r({model:e});this.$(".table").append(t.$el),this.$(".no-categories-msg").addClass("hide"),this.$("table.table").removeClass("hide")}},categoryDestroyHandler:function(e){this.model.getCategories().length==0?(this.$(".no-categories-msg").removeClass("hide"),this.$("table.table").addClass("hide")):(this.$(".no-categories-msg").addClass("hide"),this.$("table.table").removeClass("hide"))},collapseShowHandler:function(){this.$(".controls").fadeIn()},collapseHideHandler:function(){this.$(".controls").fadeOut()}});return i}),define("categories/views/AppView",["jquery","categories/models/AppModel","categories/models/CategoryGroupCollection","categories/views/CategoryGroupView","lib/backbone"],function(e,t,n,r){var i=Backbone.View.extend({el:"body",initialize:function(){n.on("reset",this.categoryGroupResetHandler,this),n.on("add",this.categoryGroupAddHandler,this),e("#create-categorygroup-button").click(_.bind(this.createCategoryGroupClickHandler,this))},createCategoryGroupClickHandler:function(e){t.openCreateCategoryGroupModal(),e.preventDefault()},categoryGroupResetHandler:function(){var t=e("#content-container");_.each(n.models,function(e){var n=new r({model:e});t.append(n.el)})},categoryGroupAddHandler:function(t){view=new r({model:t}),e("#content-container").append(view.el)}});return i}),$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,function(){e[this.name]!==undefined?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e},define("lib/jquery.serialize-object",[],function(){}),define("categories/views/CategoryGroupModalView",["jquery","categories/models/AppModel","categories/models/CategoryGroupCollection","lib/utilities","lib/backbone","lib/bootstrap","lib/jquery.serialize-object"],function(e,t,n,r){var i=Backbone.View.extend({el:"#categorygroup-modal",initialize:function(){this.EDIT_MODE="editMode",this.CREATE_MODE="createMode",t.on("openCreateCategoryGroupModal",this.openCreateCategoryGroupModal,this),t.on("openEditCategoryGroupModal",this.openEditCategoryGroupModal,this),r.autoAlphanumeric(e("#id_categorygroup_name"),e("#id_categorygroup_short_name"))},events:{"click #categorygroup-form-modal-ok-button":"okClickHandler"},setTitle:function(e){this.$el.find(".modal-header h3").text(e)},removeErrors:function(){this.$el.find(".alert").remove(),this.$el.find(".error").removeClass("error")},addErrors:function(t){var n="",r=_.template(e("#form-error-template").text());_.each(t,function(t,i){_.each(t,function(e){n+="<li>"+e+"</li>"}),e("#id_"+i).before(r({errors:n})),e("#id_"+i).parent().addClass("error"),n=""})},close:function(){this.$el.modal("hide")},open:function(){this.removeErrors(),this.$el.modal("show")},okClickHandler:function(t){if(e("#categorygroup-form-modal-ok-button").hasClass("disabled")){t.preventDefault();return}if(this.mode==this.EDIT_MODE){var r=e("#categorygroup-modal-form").serializeObject();this.model.save(r,{wait:!0,success:_.bind(this.close,this),error:_.bind(function(t,n){this.removeErrors(),n.status==400&&(resp=e.parseJSON(n.responseText),this.addErrors(resp.errors))},this)})}else{var r=e("#categorygroup-modal-form").serializeObject();n.create(r,{wait:!0,success:_.bind(this.close,this),error:_.bind(function(t,n){this.removeErrors(),n.status==400&&(resp=e.parseJSON(n.responseText),this.addErrors(resp.errors))},this)})}t.preventDefault()},openCreateCategoryGroupModal:function(){this.mode=this.CREATE_MODE,this.setTitle("Create category group"),e("#categorygroup-modal-form")[0].reset(),this.open(),e("#categorygroup-modal-form *:input[type!=hidden]:first").focus()},openEditCategoryGroupModal:function(t){this.mode=this.EDIT_MODE,this.setTitle("Edit category group"),this.model=t,this.open(),e("#id_categorygroup_name").val(this.model.get("categorygroup_name")).focus(),e("#id_categorygroup_short_name").val(this.model.get("categorygroup_short_name"))}});return i}),define("categories/views/ConfirmDeleteModalView",["jquery","categories/models/AppModel","lib/backbone"],function(e,t){var n=Backbone.View.extend({el:"#confirm-delete-modal",initialize:function(){t.on("openConfirmDeleteCategoryGroupModal",this.openConfirmDeleteCategoryGroupModal,this),t.on("openConfirmDeleteCategoryModal",this.openConfirmDeleteCategoryModal,this)},events:{"click #confirm-delete-button":"confirmDeleteHandler"},confirmDeleteHandler:function(e){this.model.destroy(),this.close(),e.preventDefault()},setMessage:function(t){e("#confirm-delete-message").html(t)},openConfirmDeleteCategoryGroupModal:function(e){this.model=e,this.setMessage("Are you sure you want to <b>permanently</b> delete this category group including all of it's categories?"),this.open()},openConfirmDeleteCategoryModal:function(e){this.model=e,this.setMessage("Are you sure you want to <b>permanently</b> delete this category?"),this.open()},close:function(){this.$el.modal("hide")},open:function(){this.$el.modal("show")}});return n}),define("categories/views/CategoryModalView",["jquery","categories/models/AppModel","categories/models/CategoryCollection","lib/utilities","lib/backbone"],function(e,t,n,r){var i=Backbone.View.extend({el:"#category-modal",initialize:function(){this.EDIT_MODE="editMode",this.CREATE_MODE="createMode",t.on("openCreateCategoryModal",this.openInCreateMode,this),t.on("openEditCategoryModal",this.openInEditMode,this),r.autoAlphanumeric(e("#id_category_name"),e("#id_category_short_name"))},events:{"click #category-form-modal-ok-button":"okButtonClickHandler"},setTitle:function(e){this.$el.find(".modal-header h3").text(e)},open:function(){this.removeErrors(),this.$el.modal("show"),e("#category-form *:input[type!=hidden]:first").focus()},close:function(){this.$el.modal("hide")},removeErrors:function(){this.$(".alert").remove(),this.$(".error").removeClass("error")},addErrors:function(t){var n="",r=_.template(e("#form-error-template").text());_.each(t,function(t,i){_.each(t,function(e){n+="<li>"+e+"</li>"}),e("#id_"+i).before(r({errors:n})),e("#id_"+i).parent().addClass("error"),n=""})},okButtonClickHandler:function(t){var r=e("#category-form").serializeObject();this.mode===this.CREATE_MODE?n.create(r,{wait:!0,success:_.bind(this.close,this),error:_.bind(function(t,n){this.removeErrors(),n.status==400&&(resp=e.parseJSON(n.responseText),this.addErrors(resp.errors))},this)}):this.mode===this.EDIT_MODE&&this.model.save(r,{wait:!0,success:_.bind(this.close,this),error:_.bind(function(){this.removeErrors(),response.status==400&&(resp=e.parseJSON(response.responseText),this.addErrors(resp.errors))},this)}),t.preventDefault()},openInCreateMode:function(t){this.mode=this.CREATE_MODE,e("#category-form")[0].reset(),this.setTitle("Create Category"),this.$("#id_categorygroup").val(t.get("id")),this.open()},openInEditMode:function(t){this.model=t,this.mode=this.EDIT_MODE,this.setTitle("Edit Category"),_.each(t.toJSON(),function(t,n){e("#category-form input[name="+n+"]").val(t)}),this.open()}});return i}),requirejs(["jquery","categories/models/AppModel","categories/models/CategoryCollection","categories/models/CategoryGroupCollection","categories/views/AppView","categories/views/CategoryGroupModalView","categories/views/ConfirmDeleteModalView","categories/views/CategoryModalView","lib/log"],function(e,t,n,r,i,s,o,u){e(function(){console.log("INIT!");var e=new i,t=new s,a=new o,f=new u;r.reset(categoryGroupData),n.reset(categoryData)})}),define("categories/Main",[],function(){})