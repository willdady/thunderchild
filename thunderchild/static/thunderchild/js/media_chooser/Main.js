define("media/models/FileUploadModel",["jquery","lib/utilities","lib/backbone"],function(e,t){var n=Backbone.Model.extend({initialize:function(e){this.file=e,this.set("name",e.name),this.xhr=new XMLHttpRequest},upload:function(){var e=new FormData;e.append("file",this.file),this.xhr.open("POST",thunderchild.uploadURL,!0),this.xhr.upload.onprogress=_.bind(function(e){var t=Math.round(e.position/e.total*100);this.trigger("progress",t)},this),this.xhr.onload=_.bind(function(e){e.currentTarget.status==200?this.trigger("complete",this):this.trigger("error",this,e)},this),this.xhr.onerror=_.bind(function(e){this.trigger("error",this,e)},this),this.xhr.setRequestHeader("X-CSRFToken",t.getCookie("csrftoken")),this.xhr.send(e)},abort:function(){this.xhr.abort()}});return n}),define("media/models/AppModel",["jquery","media/models/FileUploadModel","lib/utilities","lib/backbone"],function(e,t,n){var r=Backbone.Model.extend({showUploadModal:function(){this.trigger("showUploadModal")},showDeleteSelectedModal:function(){this.trigger("showDeleteSelectedModal")},showPreviewModal:function(e){this.trigger("showPreviewModal",e)},uploadFiles:function(e){this.uploadQueue=[],this.uploadQueueHasErrors=!1,_.each(e,function(e,n){var r=new t(e);r.on("complete",this._uploadCompleteHandler,this),r.on("error",this._uploadErrorHandler,this),this.uploadQueue.push(r),this.trigger("fileUploadQueued",r)},this),this.uploadQueue[0].upload()},_dequeueFileUploadModel:function(e){if(this.uploadQueue==undefined)return;if(this.uploadQueue.length==0)return;var t=this.uploadQueue.indexOf(e);t!==-1&&(this.uploadQueue.splice(t,1),e.off("complete",this._uploadCompleteHandler,this),e.off("error",this._uploadCompleteHandler,this))},_uploadCompleteHandler:function(e){this._dequeueFileUploadModel(e),this.uploadQueue.length>0?this.uploadQueue[0].upload():this.uploadQueueHasErrors?this.trigger("uploadsCompleteWithErrors"):this.reloadPage()},_uploadErrorHandler:function(e){this._dequeueFileUploadModel(e),this.uploadQueueHasErrors=!0,this.uploadQueue.length>0?this.uploadQueue[0].upload():this.trigger("uploadsCompleteWithErrors")},cancelAllUploads:function(){if(this.uploadQueue)for(var e=0;e<this.uploadQueue.length;e++)this.uploadQueue[e].abort();this.reloadPage()},reloadPage:function(){window.location=window.location.href.split("?")[0]},assetSelectionCallback:function(e){parent!==window&&parent.appModel.assetSelectionCallback(e)}});return new r}),define("media_chooser/views/AssetItemView",["jquery","media/models/AppModel","lib/backbone"],function(e,t){var n=Backbone.View.extend({initialize:function(){this.filename=this.$("label").text(),this.id=this.$el.attr("data-id"),this.url=this.$el.attr("data-url")},events:{click:"clickHandler"},clickHandler:function(e){t.assetSelectionCallback({id:this.id,filename:this.filename,thumbnail_url:this.$("img")[0].src,url:this.url}),e.preventDefault()}});return n}),define("media_chooser/views/AppView",["jquery","media_chooser/views/AssetItemView","media/models/AppModel","lib/backbone"],function(e,t,n){var r=Backbone.View.extend({el:"body",initialize:function(){e(".thumbnail").each(_.bind(function(e,n){new t({el:n})},this))},events:{"click #media-chooser-upload-button":"uploadButtonClickHandler"},uploadButtonClickHandler:function(e){n.showUploadModal(),e.preventDefault()}});return r}),define("media/views/UploadItemView",["jquery","lib/backbone"],function(e){var t=Backbone.View.extend({tagName:"li",template:_.template(e("#upload-item-template").text()),initialize:function(){this.$el.html(this.template(this.model.toJSON())),this.progressBar=this.$(".progress .bar"),this.model.on("progress",this.progressHandler,this),this.model.on("complete",this.completeHandler,this),this.model.on("error",this.errorHandler,this)},progressHandler:function(e){this.progressBar.css("width",e+"%")},completeHandler:function(){this.$el.addClass("complete")},errorHandler:function(){this.$el.addClass("error")}});return t}),define("media/views/UploadModalView",["jquery","media/models/AppModel","media/views/UploadItemView","lib/backbone"],function(e,t,n){var r=Backbone.View.extend({el:"#upload-modal",initialize:function(){this.CHOOSE_FILE_STATE="choose-file",this.UPLOADING_STATE="uploading",this.UPLOAD_ERRORS="upload-errors",this.modalFileField=e("#modal_file_field"),this.uploadButton=e("#modal_upload_button"),this.progressBar=this.$(".progress .bar"),t.on("showUploadModal",this.show,this),t.on("fileUploadQueued",this.fileUploadQueued,this),t.on("uploadsCompleteWithErrors",this.uploadsCompleteWithErrors,this)},events:{"click #modal_upload_button":"uploadClickHandler","change #modal_file_field":"fileFieldChangeHandler","click #cancel-uploads-button":"cancelUploadsClickHandler","click #confirm-upload-errors-button":"confirmUploadErrorsHandler"},showState:function(e){var t=this.$("[data-state]");t.filter("[data-state~='"+e+"']").show(),t.filter(":not([data-state~='"+e+"'])").hide()},uploadClickHandler:function(e){var n=this.modalFileField[0].files;n.length>0&&(this.showState(this.UPLOADING_STATE),t.uploadFiles(n)),e.preventDefault()},show:function(){this.uploadButton.addClass("disabled"),e("#modal_upload_form")[0].reset(),this.showState(this.CHOOSE_FILE_STATE),this.$el.modal("show")},fileFieldChangeHandler:function(){this.uploadButton.removeClass("disabled")},fileUploadQueued:function(e){var t=new n({model:e});this.$(".modal-body div[data-state~=uploading] ul").append(t.el)},cancelUploadsClickHandler:function(e){t.cancelAllUploads(),e.preventDefault()},uploadsCompleteWithErrors:function(){this.showState(this.UPLOAD_ERRORS)},confirmUploadErrorsHandler:function(e){t.reloadPage(),e.preventDefault()}});return r}),requirejs(["jquery","media_chooser/views/AppView","media/views/UploadModalView","lib/log"],function(e,t,n){e(function(){var e=new t,r=new n})}),define("media_chooser/Main",[],function(){})