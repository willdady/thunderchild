(function(){var a,i,j,d,l,f,c,k,h,b,g;var e=function(m,n){return function(){return m.apply(n,arguments)}};g="/backend/api/templates/template";b="/backend/api/templates/group";i=Backbone.Model.extend({selectedTemplate:function(m){if(m){this.set("selectedTemplate",m)}return this.get("selectedTemplate")},openNewTemplateModal:function(m){return this.trigger("openNewTemplateModal",m)}});h=Backbone.Model.extend({urlRoot:g});l=Backbone.Collection.extend({model:h,url:g});a=Backbone.View.extend({events:{"click #create-templategroup-button":"createTemplateGroupClickHandler","click #delete-template-button":"deleteTemplateClickHandler","click #save-template-button":"saveTemplateClickHandler"},createTemplateGroupClickHandler:function(m){log("createTemplateGroupClickHandler");return m.preventDefault()},deleteTemplateClickHandler:function(m){log("deleteTemplateClickHandler");return m.preventDefault()},saveTemplateClickHandler:function(m){log("saveTemplateClickHandler");return m.preventDefault()}});j=Backbone.View.extend({initialize:function(){return this.model.on("openNewTemplateModal",this.open,this)},events:{"click #create-template-button":"createTemplateButtonClickHandler"},open:function(m){$("#id2_templategroup").val(m);this.$el.find(".alert").remove();this.$el.find(".error").removeClass("error");this.$el.find("form").each(function(){return this.reset()});this.$el.modal("show");return $("#id2_template_short_name").focus()},close:function(){return this.$el.modal("hide")},createTemplateButtonClickHandler:function(n){var m;m=this.$el.find("form").serializeObject();m.template_cache_timeout=0;this.temp_model=new h(m);this.temp_model.save({},{success:e(function(p,o){this.collection.add(p);return this.close()},this),error:function(q,o){var p,r;if(o.status===400){r=$.parseJSON(o.responseText);p="";return _.each(r.errors,function(t,s){_.each(t,function(v,u){return p+=_.template("<li><%= error %></li>",{error:v})});$("#id2_"+s).before(_.template($("#form-error-template").text(),{errors:p}));return $("#id2_"+s).parent().addClass("error")})}}});return n.preventDefault()}});c=Backbone.View.extend({initialize:function(){this.id=parseInt(this.$el.attr("data-id"));this.$el.find("ul li").each(e(function(n,o){var m;m=new h({id:$(o).attr("data-id"),templategroup:this.id});new k({el:o,model:m,appModel:this.model});return this.collection.add(m,{silent:true})},this));return this.collection.on("add",this.templateAddedHandler,this)},events:{"click .new-template-button":"newTemplateButtonClickHandler"},newTemplateButtonClickHandler:function(m){this.model.openNewTemplateModal(this.id);m.stopPropagation();return m.preventDefault()},templateAddedHandler:function(n){var m,o;if(n.get("templategroup")===this.id){m=$(_.template($("#template-list-item-template").text(),n.toJSON()));this.$el.find("ul").prepend(m);this.$el.find("ul>li").tsort();o=new k({el:m,model:n,appModel:this.model});o.modelPopulated=true;return this.model.selectedTemplate(n)}}});k=Backbone.View.extend({initialize:function(){this.modelPopulated=false;this.options.appModel.on("change:selectedTemplate",this.selectedTemplateChangeHandler,this);return this.model.on("change",this.modelChangeHandler,this)},events:{"click a":"clickHandler"},modelChangeHandler:function(){return this.modelPopulated=true},clickHandler:function(m){this.options.appModel.selectedTemplate(this.model);if(!this.modelPopulated){this.model.fetch()}return m.preventDefault()},selectedTemplateChangeHandler:function(){if(this.options.appModel.get("selectedTemplate")===this.model){return this.$el.addClass("active")}else{return this.$el.removeClass("active")}}});f=Backbone.View.extend({initialize:function(){this.editor=ace.edit("editor");this.editor.setTheme("ace/theme/twilight");this.editor.setShowPrintMargin(false);this.setMode("ace/mode/html");return this.model.on("change:selectedTemplate",this.selectedTemplateChangeHandler,this)},selectedTemplateChangeHandler:function(){if(this.templateModel){this.templateModel.off("change",this.populateFromModel,this)}this.templateModel=this.model.get("selectedTemplate");this.templateModel.on("change",this.populateFromModel,this);return this.populateFromModel()},populateFromModel:function(){var m;m=this.templateModel.get("template_content");if(m){return this.editor.getSession().getDocument().setValue(m)}},setMode:function(m){var n;n=require(m).Mode;return this.editor.getSession().setMode(new n())}});d=Backbone.View.extend({initialize:function(){return this.model.on("change:selectedTemplate",this.selectedTemplateChangeHandler,this)},selectedTemplateChangeHandler:function(){if(this.templateModel){this.templateModel.off("change",this.populateFromModel,this)}this.templateModel=this.model.get("selectedTemplate");this.templateModel.on("change",this.populateFromModel,this);return this.populateFromModel()},populateFromModel:function(){if(this.templateModel.get("template_short_name")){$("#id_template_short_name").val(this.templateModel.get("template_short_name"));$("#id_template_content_type").val(this.templateModel.get("template_content_type"));$("#id_template_cache_timeout").val(this.templateModel.get("template_cache_timeout"));$("#id_template_redirect_type").val(this.templateModel.get("template_redirect_type"));$("#id_template_redirect_url").val(this.templateModel.get("template_redirect_url"));$("input:radio[name=template_is_private][value='True']").attr("checked",this.templateModel.get("template_is_private"));return $("input:radio[name=template_is_private][value='False']").attr("checked",!this.templateModel.get("template_is_private"))}}});$(function(){var r,p,q,n,o,m;p=new i();o=new l();r=new a({el:$(".action-bar"),model:p});m=new f({el:$("#editor-pane"),model:p});n=new d({el:$("#settings-pane"),model:p});q=new j({el:$("#create-template-modal"),model:p,collection:o});$("#template-browser > ul > li").each(function(s,t){return new c({el:t,model:p,collection:o})});$("#tabs a").click(function(s){$(this).tab("show");return s.preventDefault()});return $("#tabs a:first").tab("show")})}).call(this);