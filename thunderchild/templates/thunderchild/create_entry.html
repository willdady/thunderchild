{% extends "thunderchild/base.html" %}

{% block css %}
<link rel="stylesheet" href="{{ STATIC_URL }}thunderchild/css/cupertino/jquery-ui-1.8.21.custom.css" type="text/css" media="screen"/>
<link rel="stylesheet" href="{{ STATIC_URL }}thunderchild/css/farbtastic.css" type="text/css" media="screen"/>
{% endblock %}

{% block content %}
		
		<header>
			<h1>Create Entry</h1>
		</header>
		
		<ul class="nav nav-tabs" id="tabs">
			<li><a href="#fields" data-toggle="tab">Fields</a></li>
			<li><a href="#dates" data-toggle="tab">Dates</a></li>
			<li><a href="#comments" data-toggle="tab">Comments</a></li>
			{% if has_categorygroup %}
			<li><a href="#categories" data-toggle="tab">Categories</a></li>
			{% endif %}
		</ul>
		
		<form action="{% url thunderchild.entry_views.create_entry entrytype_id %}" method="post">{% csrf_token %}
			<div class="tab-content">
				
				<div id="fields" class="tab-pane">
					
					{{ form1.entrytype }}
					
					<div class="accordion-group">
							<div class="field_label_holder" data-toggle="collapse" data-target="#form1_fieldholder_title">
								{% if form1.title.field.required %}<span class="required">* </span>{% endif %}{{ form1.title.label_tag }}
								{% if form1.title.errors %}<div class="alert alert-error">{{ form1.title.errors }}</div>{% endif %}
							</div>
							<div id="form1_fieldholder_title" class="collapse control-group field_holder {% if form1.title.errors %}error{% endif %} {% if not form1.title.field.field_collapsed_by_default %}in{% endif %}">
								{{ form1.title }}
								{% if form1.title.help_text %}<p class="help_text">{{ form1.title.help_text }}</p>{% endif %}
							</div>
					</div>
					
					<div class="accordion-group">
							<div class="field_label_holder" data-toggle="collapse" data-target="#form1_fieldholder_slug">
								{% if form1.slug.field.required %}<span class="required">* </span>{% endif %}{{ form1.slug.label_tag }}
								{% if form1.slug.errors %}<div class="alert alert-error">{{ form1.slug.errors }}</div>{% endif %}
							</div>
							<div id="form1_fieldholder_slug" class="collapse control-group field_holder {% if form1.slug.errors %}error{% endif %} {% if not form1.slug.field.field_collapsed_by_default %}in{% endif %}">
								{{ form1.slug }}
								{% if form1.slug.help_text %}<p class="help_text">{{ form1.slug.help_text }}</p>{% endif %}
							</div>
					</div>
					
					{% for field in form2 %}
						{% if not field.is_hidden %}
						<div class="accordion-group">
							<div class="field_label_holder" data-toggle="collapse" data-target="#form2_fieldholder_{{ forloop.counter }}">
								{% if field.field.required %}<span class="required">* </span>{% endif %}{{ field.label_tag }}
								{% if field.errors %}<div class="alert alert-error">{{ field.errors }}</div>{% endif %}
							</div>
							<div id="form2_fieldholder_{{ forloop.counter }}" class="collapse control-group field_holder {% if field.errors %}error{% endif %} {% if not field.field.field_collapsed_by_default %}in{% endif %}">
								{% for key, value in media_assets.items %}
									{% ifequal key field.html_name %}
									<div class="media-asset-thumbnail">
										<img src="{{ value.thumbnail_url }}" alt="Media asset thumbnail" />
										<ul>
											<li>{{ value.filename }}</li>
										</ul>
									</div>
									{% endifequal %}				
								{% endfor %}
								
								{{ field }}
								{% if field.help_text %}<p class="help_text">{{ field.help_text }}</p>{% endif %}
							</div>
						</div>
						{% else %}
							{{ field }}
						{% endif %}
					{% endfor %}
					
					<div class="accordion-group">
							<div class="field_label_holder" data-toggle="collapse" data-target="#form1_fieldholder_is_published">
								{% if form1.is_published.field.required %}<span class="required">* </span>{% endif %}{{ form1.is_published.label_tag }}
								{% if form1.is_published.errors %}<div class="alert alert-error">{{ form1.is_published.errors }}</div>{% endif %}
							</div>
							<div id="form1_fieldholder_is_published" class="collapse control-group field_holder {% if form1.is_published.errors %}error{% endif %} {% if not form1.is_published.field.field_collapsed_by_default %}in{% endif %}">
								{{ form1.is_published }}
								{% if form1.is_published.help_text %}<p class="help_text">{{ form1.is_published.help_text }}</p>{% endif %}
							</div>
					</div>
				</div>
				
				<div id="dates" class="tab-pane">
					<div class="accordion-group">
							<div class="field_label_holder" data-toggle="collapse" data-target="#form1_fieldholder_creation_date">
								{% if form1.creation_date.field.required %}<span class="required">* </span>{% endif %}{{ form1.creation_date.label_tag }}
								{% if form1.creation_date.errors %}<div class="alert alert-error">{{ form1.creation_date.errors }}</div>{% endif %}
							</div>
							<div id="form1_fieldholder_creation_date" class="collapse control-group field_holder {% if form1.creation_date.errors %}error{% endif %} {% if not form1.creation_date.field.field_collapsed_by_default %}in{% endif %}">
								{{ form1.creation_date }}
								{% if form1.creation_date.help_text %}<p class="help_text">{{ form1.creation_date.help_text }}</p>{% endif %}
							</div>
					</div>
					
					<div class="accordion-group">
							<div class="field_label_holder" data-toggle="collapse" data-target="#form1_fieldholder_expiration_date">
								{% if form1.expiration_date.field.required %}<span class="required">* </span>{% endif %}{{ form1.expiration_date.label_tag }}
								{% if form1.expiration_date.errors %}<div class="alert alert-error">{{ form1.expiration_date.errors }}</div>{% endif %}
							</div>
							<div id="form1_fieldholder_expiration_date" class="collapse control-group field_holder {% if form1.expiration_date.errors %}error{% endif %} {% if not form1.expiration_date.field.field_collapsed_by_default %}in{% endif %}">
								{{ form1.expiration_date }}
								{% if form1.expiration_date.help_text %}<p class="help_text">{{ form1.expiration_date.help_text }}</p>{% endif %}
							</div>
					</div>
				</div>
				
				<div id="comments" class="tab-pane">
					<div class="accordion-group">
						<div class="field_label_holder" data-toggle="collapse" data-target="#form1_fieldholder_comments_enabled">
							{% if form1.comments_enabled.field.required %}<span class="required">* </span>{% endif %}{{ form1.comments_enabled.label_tag }}
							{% if form1.comments_enabled.errors %}<div class="alert alert-error">{{ form1.comments_enabled.errors }}</div>{% endif %}
						</div>
						<div id="form1_fieldholder_comments_enabled" class="collapse control-group field_holder {% if form1.comments_enabled.errors %}error{% endif %} {% if not form1.comments_enabled.field.field_collapsed_by_default %}in{% endif %}">
							{{ form1.comments_enabled }}
							{% if form1.comments_enabled.help_text %}<p class="help_text">{{ form1.comments_enabled.help_text }}</p>{% endif %}
						</div>
					</div>
					
					<div class="accordion-group">
						<div class="field_label_holder" data-toggle="collapse" data-target="#form1_fieldholder_comments_expiration_date">
							{% if form1.comments_expiration_date.field.required %}<span class="required">* </span>{% endif %}{{ form1.comments_expiration_date.label_tag }}
							{% if form1.comments_expiration_date.errors %}<div class="alert alert-error">{{ form1.comments_expiration_date.errors }}</div>{% endif %}
						</div>
						<div id="form1_fieldholder_comments_expiration_date" class="collapse control-group field_holder {% if form1.comments_expiration_date.errors %}error{% endif %} {% if not form1.comments_expiration_date.field.field_collapsed_by_default %}in{% endif %}">
							{{ form1.comments_expiration_date }}
							{% if form1.comments_expiration_date.help_text %}<p class="help_text">{{ form1.comments_expiration_date.help_text }}</p>{% endif %}
						</div>
					</div>
				</div>
				{% if has_categorygroup %}
				<div id="categories" class="tab-pane">
					<div class="accordion-group">
						<div class="field_label_holder" data-toggle="collapse" data-target="#form1_fieldholder_categories">
							{% if form1.categories.field.required %}<span class="required">* </span>{% endif %}{{ form1.categories.label_tag }}
							{% if form1.categories.errors %}<div class="alert alert-error">{{ form1.categories.errors }}</div>{% endif %}
						</div>
						<div id="form1_fieldholder_categories" class="collapse control-group field_holder {% if form1.categories.errors %}error{% endif %} {% if not form1.categories.field.field_collapsed_by_default %}in{% endif %}">
							{{ form1.categories }}
							{% if form1.categories.help_text %}<p class="help_text">{{ form1.categories.help_text }}</p>{% endif %}
						</div>
					</div>
				</div>
				{% endif %}
			</div>
			<div class="row">
				<input class="btn pull-right" type="submit" value="Create" />
			</div>
		</form>
		
		<div id="media_chooser_modal" class="modal" style="display:none;">
			<div class="modal-header">
				<button class="close" data-dismiss="modal">Ã—</button>
				<h3>Media</h3>
			</div>
			<div class="modal-body">
				<iframe src="{% url thunderchild.media_views.media_chooser %}"></iframe>
			</div>
		</div>
		
		<script type="text/html" id="mediaAssetThumbnailTemplate">
			<div class="media-asset-thumbnail">
				<img src="<%= thumbnail_url %>" alt="Media asset thumbnail" />
				<ul>
					<li><%= filename %></li>
				</ul>
			</div>
		</script>
		
		{% include 'thunderchild/includes/textarea_controls.html' %}
		{% include 'thunderchild/includes/textarea_modal.html' %}
{% endblock %}

{% block javascript %}
<script type="text/javascript" src="{{ STATIC_URL }}thunderchild/js/jquery-ui-1.8.21.custom.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}thunderchild/js/jquery-ui-timepicker-addon.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}thunderchild/js/farbtastic.js"></script>
{% if debug %}
	<script type="text/javascript" src="{{ STATIC_URL }}thunderchild/js_src/entry.js"></script>
{% else %}
	<script type="text/javascript" src="{{ STATIC_URL }}thunderchild/js/entry-min.js"></script>
{% endif %}
<script type="text/javascript">
	// This stops label elements from triggering their associated fields when clicked.
	$(".field_label_holder label").click(function(e){
		e.preventDefault();
	});
	Utilities.autoSlug( $("#id_title"), $("#id_slug") );
	// Initialize date and datetime pickers
	$('[data-field-type="datetime"]').datetimepicker({
		dateFormat:'yy-mm-dd',
		timeFormat:'hh:mm:ss',
		showSecond:true,
	});
	$('[data-field-type="date"]').datepicker({
		dateFormat:'yy-mm-dd',
	});
	var appModel = new window.AppModel();
	var mediaChooserModal = new window.MediaChooserModalView({el:$("#media_chooser_modal"), model:appModel});
	$('[data-field-type="file"]').each(function() {
		new window.MediaChooserWidgetView({el:$(this), model:appModel});
	});
	// Convert all textareas to rich textareas. Note the textearea in the textarea modal will not create a fullscreen button
	$('textarea').each(function() {
		el = $(this)
		if (el.attr("id") !== "textarea-modal-textarea") {
			new window.RichTextAreaView({el:el, model:appModel});
		} else {
			new window.RichTextAreaView({el:el, model:appModel, noFullscreen:true, hideMediaChooserBackdrop:true});
		}
	});
	
	var textAreaModal = new window.TextAreaModalView({el:$("#textarea-modal"), model:appModel})
	
	// Activate tabs
	$("#tabs a").click(function(e){
		$(this).tab("show");
		e.preventDefault();
	});
	$("#tabs a:first").tab("show");
	
	// Activate color pickers
	$('[data-field-type="color"]').each(function(i, el) {
		console.log("OK");
		var pickerID = "picker"+i;
		var picker = $('<div id="'+pickerID+'" class="picker"></div>');
		$(this).parent().append(picker)
		$(picker).farbtastic($(this));
	});
	
</script>
{% endblock %}
