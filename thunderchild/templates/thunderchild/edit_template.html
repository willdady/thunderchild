{% extends "thunderchild/base.html" %}

{% block title %}Edit Template{% endblock %}
{% block title_bar_title %}Edit Template{% endblock %}

{% block breadcrumbs %}
<ul class="breadcrumb">
	<li>
		<a href="{% url thunderchild.template_views.templates %}">Templates</a> <span class="divider">/</span>
	</li>
</ul>
{% endblock %}

{% block content %}
		<form action="{% url thunderchild.template_views.edit_template templategroup_id template_id %}" method="post">{% csrf_token %}
			{% if is_index %}
				<div class="accordion-group">
						<div class="field_label_holder" data-toggle="collapse" data-target="#form_fieldholder_{{ forloop.counter }}">
							<p>Name</p>
						</div>
						<div id="form_fieldholder_{{ forloop.counter }}" class="collapse control-group field_holder {% if field.errors %}error{% endif %} {% if not field.field.field_collapsed_by_default %}in{% endif %}">
							<p>index</p>
						</div>
				</div>
			{% endif %}
			{% for field in form %}
				{% if not field.is_hidden %}
				<div class="accordion-group">
						<div class="field_label_holder" data-toggle="collapse" data-target="#form_fieldholder_{{ forloop.counter }}">
							{% if field.field.required %}<span class="required">* </span>{% endif %}{{ field.label_tag }}
							{% if field.errors %}<div class="alert alert-error">{{ field.errors }}</div>{% endif %}
						</div>
						<div id="form_fieldholder_{{ forloop.counter }}" class="collapse control-group field_holder {% if field.errors %}error{% endif %} {% if not field.field.field_collapsed_by_default %}in{% endif %}">
							{{ field }}
							{% if field.help_text %}<p class="help_text">{{ field.help_text }}</p>{% endif %}
						</div>
				</div>
				{% else %}
					{{ field }}
				{% endif %}
			{% endfor %}
			<div class="row">
				<div class="pull-right">
					{% if is_index %}
						<a class="btn btn-danger" data-toggle="modal" href="#alert_modal"><i class="icon-trash icon-white"></i> Delete</a>
					{% else %}
						<a class="btn btn-danger" data-toggle="modal" href="#confirm_delete_modal"><i class="icon-trash icon-white"></i> Delete</a>
					{% endif %}
					<input class="btn" name="submit-button" type="submit" value="Save" />
					<input class="btn" name="submit-button" type="submit" value="Save and finish" />
				</div>
			</div>
		</form>
		
{% if is_index %}
	{% include "thunderchild/includes/alert_modal.html" with modal_message="Deleting index templates is forbidden as each template group must have an index template." %}
{% else %}
	{% include "thunderchild/includes/confirm_delete_modal.html" with modal_message="Are you sure you want to <b>permanently</b> delete this Template?" action=delete_url id=template_id %}
{% endif %}
		
{% endblock %}

{% block javascript %}
<script>
{% if is_index %}
	$("#alert_modal").modal().modal("hide");
{% else %}
	$("#confirm_delete_modal").modal().modal("hide");
{% endif %}
	// This stops label elements from triggering their associated fields when clicked.
	$(".field_label_holder label").click(function(e){
		e.preventDefault();
	});
</script>
{% endblock %}