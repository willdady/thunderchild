{% extends "thunderchild/base.html" %}

{% block css %}
<link rel="stylesheet" href="{{ STATIC_URL }}thunderchild/css/cupertino/jquery-ui-1.8.21.custom.css" type="text/css" media="screen"/>
{% endblock %}

{% block content %}

		<ul class="breadcrumb">
			<li>
				<a href="{% url thunderchild.entry_views.entries %}">Entries</a> <span class="divider">/</span>
			</li>
			<li class="active">
				Edit Entry
			</li>
		</ul>
		
		<header>
			<h1>Edit Entry</h1>
			<h2>{{ entrytype_name }}</h2>
		</header>
		
		<form action="{% url thunderchild.entry_views.edit_entry entry_id %}" method="post">{% csrf_token %}
		{% for field in form1 %}
		{% if not field.is_hidden %}
		<div class="accordion-group">
				<div class="field_label_holder" data-toggle="collapse" data-target="#form1_fieldholder_{{ forloop.counter }}">
					{{ field.label_tag }}
					{% if field.errors %}<div class="alert alert-error">{{ field.errors }}</div>{% endif %}
				</div>
				<div id="form1_fieldholder_{{ forloop.counter }}" class="collapse control-group field_holder {% if field.errors %}error{% endif %} {% if not field.field.field_collapsed_by_default %}in{% endif %}">
					{{ field }}
					{% if field.help_text %}<p class="help_text">{{ field.help_text }}</p>{% endif %}
				</div>
		</div>
		{% else %}
			{{ field }}
		{% endif %}
		{% endfor %}
		
		
		{% for field in form2 %}
		{% if not field.is_hidden %}
		<div class="accordion-group">
			<div class="field_label_holder" data-toggle="collapse" data-target="#form2_fieldholder_{{ forloop.counter }}">
				{{ field.label_tag }}
				{% if field.errors %}<div class="alert alert-error">{{ field.errors }}</div>{% endif %}
			</div>
			<div id="form2_fieldholder_{{ forloop.counter }}" class="collapse control-group field_holder {% if field.errors %}error{% endif %} {% if not field.field.field_collapsed_by_default %}in{% endif %}">
				{% for key, value in media_assets.items %}
					{% ifequal key field.html_name %}
					<div class="media-asset-thumbnail">
						<img src="{{ value.thumbnail_url }}" alt="Media asset thumbnail" />
						<ul>
							<li>{{ value.filename }}</li>
						</ul>
					</div>
					{% endifequal %}				
				{% endfor %}
				
				{{ field }}
				{% if field.help_text %}<p class="help_text">{{ field.help_text }}</p>{% endif %}
			</div>
		</div>
		{% else %}
			{{ field }}
		{% endif %}
		{% endfor %}
		<div class="row">
			<div class="pull-right">
				<a class="btn btn-danger" data-toggle="modal" href="#confirm_delete_modal"><i class="icon-trash icon-white"></i> Delete</a>
				<input class="btn" type="submit" value="Save" />
			</div>
		</div>
		</form>
		
		<div id="confirm_delete_modal" class="modal">
			<div class="modal-header">
				<button class="close" data-dismiss="modal">×</button>
				<h3>Confirm Delete</h3>
			</div>
			<div class="modal-body">
				<p>Are you sure you want to <b>permanently</b> delete this entry?</p>
			</div>
			<div class="modal-footer">
				<a href="#" class="btn" data-dismiss="modal">Cancel</a>
				<a href="#" class="btn btn-danger"><i class="icon-trash icon-white"></i> Confirm Delete</a>
			</div>
		</div>
		
		<div id="media_chooser_modal" class="modal">
			<div class="modal-header">
				<button class="close" data-dismiss="modal">×</button>
				<h3>Media</h3>
			</div>
			<div class="modal-body">
				<iframe src="{% url thunderchild.media_views.media_chooser %}"></iframe>
			</div>
		</div>
		
		<script type="text/html" id="mediaAssetThumbnailTemplate">
			<div class="media-asset-thumbnail">
				<img src="<%= thumbnail_url %>" alt="Media asset thumbnail" />
				<ul>
					<li><%= filename %></li>
				</ul>
			</div>
		</script>
		
{% endblock %}

{% block javascript %}
<script type="text/javascript" src="{{ STATIC_URL }}thunderchild/js/jquery-ui-1.8.21.custom.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}thunderchild/js/jquery-ui-timepicker-addon.js"></script>
{% if debug %}
	<script type="text/javascript" src="{{ STATIC_URL }}thunderchild/js_src/entry.js"></script>
{% else %}
	<script type="text/javascript" src="{{ STATIC_URL }}thunderchild/js/entry-min.js"></script>
{% endif %}
<script type="text/javascript">
	$("#confirm_delete_modal").modal().modal("hide");
	// This stops label elements from triggering their associated fields when clicked.
	$(".field_label_holder label").click(function(e){
		e.preventDefault();
	});
	
	Utilities.autoSlug( $("#id_title"), $("#id_slug") );
	
	// Initialize date and datetime pickers
	$('[data-field-type="datetime"]').datetimepicker({
		dateFormat:'yy-mm-dd',
		timeFormat:'hh:mm:ss',
		showSecond:true,
	});
	$('[data-field-type="date"]').datepicker({
		dateFormat:'yy-mm-dd',
	});
	
	var appModel = new window.AppModel();
	var mediaChooserModal = new window.MediaChooserModalView({el:$("#media_chooser_modal"), model:appModel});
	$('[data-field-type="file"]').each(function() {
		new window.MediaChooserWidgetView({el:$(this), model:appModel});
	});
	
</script>
{% endblock %}